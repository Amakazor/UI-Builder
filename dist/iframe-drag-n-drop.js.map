{"version":3,"sources":["../src/iframe-drag-n-drop.js"],"names":["isAlign","targetOffset","currentOffset","isHorizontalAlign","Math","abs","top","isVerticalAlign","left","removeAlignmentLines","$","remove","self","arrowKeyMove","key","element","dx","dy","x","parseFloat","attr","y","css","transform","dragAlignmentLine","get","target","horizontalLineExists","verticalLineExists","offset","Array","from","filter","currentValue","some","addClass","appendTo","document","ready","enteredDropzone","isDropzoneParent","parents","length","getAbsolutePositionParent","$element","console","log","parent","setTransformStyle","style","webkitTransform","interact","dropzone","accept","overlap","ondropactivate","event","classList","add","ondragenter","draggableElement","relatedTarget","dropzoneElement","ondragleave","ondrop","$parent","ondropdeactivate","resizable","edges","right","bottom","restrictEdges","outer","endOnly","restrictSize","min","width","height","inertia","on","getAttribute","rect","deltaRect","setAttribute","draggable","restrict","restriction","body","elementRect","autoScroll","onmove","onend"],"mappings":"AAAA,CAAC,YAAY;AACT,QAAMA,UAAU,SAAVA,OAAU,CAACC,YAAD,EAAeC,aAAf;AAAA,eAAkC;AAC9CC,+BAAmBC,KAAKC,GAAL,CAASJ,aAAaK,GAAb,GAAmBJ,cAAcI,GAA1C,KAAkD,CADvB;AAE9CC,6BAAiBH,KAAKC,GAAL,CAASJ,aAAaO,IAAb,GAAoBN,cAAcM,IAA3C,KAAoD;AAFvB,SAAlC;AAAA,KAAhB;;AAKA,QAAMC,uBAAuB,SAAvBA,oBAAuB;AAAA,eAAMC,EAAE,kCAAF,EAAsCC,MAAtC,EAAN;AAAA,KAA7B;;AAEAC,SAAKC,YAAL,GAAoB,UAACC,GAAD,EAAMC,OAAN,EAAkB;AAClCN;;AAEA,YAAIO,KAAK,CAAT;AAAA,YAAYC,KAAK,CAAjB;AACA,gBAAQH,GAAR;AACI,iBAAK,EAAL;AAAS;AACLE,qBAAK,CAAC,CAAN;AACA;AACJ,iBAAK,EAAL;AAAS;AACLC,qBAAK,CAAC,CAAN;AACA;AACJ,iBAAK,EAAL;AAAS;AACLD,qBAAK,CAAL;AACA;AACJ,iBAAK,EAAL;AAAS;AACLC,qBAAK,CAAL;AACA;AACJ;AAAS,uBAbb,CAaqB;AAbrB;;AAgBA;AACA,YAAMC,IAAI,CAACC,WAAWJ,QAAQK,IAAR,CAAa,QAAb,CAAX,KAAsC,CAAvC,IAA4CJ,EAAtD;AAAA,YACIK,IAAI,CAACF,WAAWJ,QAAQK,IAAR,CAAa,QAAb,CAAX,KAAsC,CAAvC,IAA4CH,EADpD;;AAGAF,gBAAQO,GAAR,CAAY;AACRC,sCAAwBL,CAAxB,YAAgCG,CAAhC;AADQ,SAAZ;;AAIA;AACAN,gBAAQK,IAAR,CAAa,QAAb,EAAuBF,CAAvB;AACAH,gBAAQK,IAAR,CAAa,QAAb,EAAuBC,CAAvB;;AAEAG,0BAAkBT,QAAQU,GAAR,CAAY,CAAZ,CAAlB;AACH,KAjCD;;AAmCA,QAAMD,oBAAoB,SAApBA,iBAAoB,CAACE,MAAD,EAAY;AAClC,YAAIC,uBAAuB,KAA3B;AACA,YAAIC,qBAAqB,KAAzB;AACA,YAAM3B,eAAeS,EAAEgB,MAAF,EAAUG,MAAV,EAArB;;AAEAC,cAAMC,IAAN,CAAWrB,EAAE,4BAAF,CAAX,EACKsB,MADL,CACY;AAAA,mBAAgBC,gBAAgBP,MAAhC;AAAA,SADZ,EAEKQ,IAFL,CAEU,wBAAgB;AAClB,gBAAMhC,gBAAgBQ,EAAEuB,YAAF,EAAgBJ,MAAhB,EAAtB;;AADkB,2BAE6B7B,QAAQC,YAAR,EAAsBC,aAAtB,CAF7B;AAAA,gBAEVC,iBAFU,YAEVA,iBAFU;AAAA,gBAESI,eAFT,YAESA,eAFT;;AAGlB,gBAAI,CAACoB,oBAAD,IAAyBxB,iBAA7B,EAAgD;AAC5CO,kBAAE,QAAF,EACKyB,QADL,CACc,iBADd,EAEKb,GAFL,CAES;AACDhB,yBAAKL,aAAaK;AADjB,iBAFT,EAKK8B,QALL,CAKc1B,EAAE,MAAF,CALd;AAMAiB,uCAAuB,IAAvB;AACH;AACD,gBAAI,CAACC,kBAAD,IAAuBrB,eAA3B,EAA4C;AACxCG,kBAAE,QAAF,EACKyB,QADL,CACc,eADd,EAEKb,GAFL,CAES;AACDd,0BAAMP,aAAaO;AADlB,iBAFT,EAKK4B,QALL,CAKc1B,EAAE,MAAF,CALd;AAMAkB,qCAAqB,IAArB;AACH;AACD,mBAAOD,wBAAwBC,kBAA/B;AACH,SAxBL;AAyBH,KA9BD;;AAgCAlB,MAAE2B,QAAF,EAAYC,KAAZ,CAAkB,YAAM;AACpB,YAAIC,kBAAkB,KAAtB;AACA,YAAMC,mBAAmB,SAAnBA,gBAAmB;AAAA,mBAAW,CAAC,CAAC9B,EAAEK,OAAF,EAAW0B,OAAX,CAAmB,WAAnB,EAAgCC,MAA7C;AAAA,SAAzB;AACA,YAAMC,4BAA4B,SAA5BA,yBAA4B,WAAY;AAC1C,gBAAI,CAACC,SAASF,MAAV,IAAoBE,SAAStB,GAAT,CAAa,UAAb,KAA4B,UAApD,EAAgE;AAC5DuB,wBAAQC,GAAR,CAAYF,SAAStB,GAAT,CAAa,UAAb,CAAZ;AACA,uBAAOsB,QAAP;AACH,aAHD,MAGO;AACH,uBAAOD,0BAA0BC,SAASG,MAAT,EAA1B,CAAP;AACH;AACJ,SAPD;;AASA,YAAMC,oBAAoB,SAApBA,iBAAoB,CAACjC,OAAD,EAAUP,IAAV,EAAgBF,GAAhB,EAAwB;AAC9CS,oBAAQkC,KAAR,CAAcC,eAAd,GACInC,QAAQkC,KAAR,CAAc1B,SAAd,kBACaf,IADb,YACwBF,GADxB,QADJ;AAGA,mBAAOI,EAAEK,OAAF,CAAP;AACH,SALD;;AAOA;AACAoC,iBAAS,WAAT,EACKC,QADL,CACc;AACN;AACAC,oBAAQ,QAFF;AAGN;AACAC,qBAAS,IAJH;AAKN;AACAC,4BAAgB,wBAAUC,KAAV,EAAiB;AAC7B;AACAA,sBAAM9B,MAAN,CAAa+B,SAAb,CAAuBC,GAAvB,CAA2B,aAA3B;AACH,aATK;AAUNC,yBAAa,qBAAUH,KAAV,EAAiB;AAC1B,oBAAII,mBAAmBJ,MAAMK,aAA7B;AAAA,oBACIC,kBAAkBN,MAAM9B,MAD5B;;AAGA;AACAoC,gCAAgBL,SAAhB,CAA0BC,GAA1B,CAA8B,aAA9B;AACAE,iCAAiBH,SAAjB,CAA2BC,GAA3B,CAA+B,UAA/B;AACH,aAjBK;AAkBNK,yBAAa,qBAAUP,KAAV,EAAiB;AAC1B;AACAA,sBAAM9B,MAAN,CAAa+B,SAAb,CAAuB9C,MAAvB,CAA8B,aAA9B;AACA6C,sBAAMK,aAAN,CAAoBJ,SAApB,CAA8B9C,MAA9B,CAAqC,UAArC;AACA4B,kCAAkB,KAAlB;AACH,aAvBK;AAwBNyB,oBAAQ,uBAAS;AACbzB,kCAAkB,IAAlB;;AAEA,oBAAI/B,aAAJ;AAAA,oBAAUF,YAAV;AACA;AACA;AACA;AACA,oBAAM2D,UAAUtB,0BAA0BjC,EAAE8C,MAAM9B,MAAR,CAA1B,CAAhB;AACA,oBAAIqB,OAAOL,MAAX,EAAmB;AACflC,2BAAOE,EAAE8C,MAAMK,aAAR,EAAuBhC,MAAvB,GAAgCrB,IAAhC,GAAuCyD,QAAQpC,MAAR,GAAiBrB,IAA/D;AACAF,0BAAMI,EAAE8C,MAAMK,aAAR,EAAuBhC,MAAvB,GAAgCvB,GAAhC,GAAsC2D,QAAQpC,MAAR,GAAiBvB,GAA7D;AACH,iBAHD,MAGO;AACHE,2BAAOE,EAAE8C,MAAMK,aAAR,EAAuBhC,MAAvB,GAAgCrB,IAAvC;AACAF,0BAAMI,EAAE8C,MAAMK,aAAR,EAAuBhC,MAAvB,GAAgCvB,GAAtC;AACH;;AAEDI,kBAAE8C,MAAMK,aAAR,EAAuBzB,QAAvB,CAAgC1B,EAAE8C,MAAM9B,MAAR,CAAhC;AACAsB,kCAAkBQ,MAAMK,aAAxB,EAAuCrD,IAAvC,EAA6CF,GAA7C,EACKgB,GADL,CACS;AACDd,0BAAM,CADL;AAEDF,yBAAK;AAFJ,iBADT,EAKKc,IALL,CAKU;AACF,8BAAUZ,IADR;AAEF,8BAAUF;AAFR,iBALV;AASH,aAlDK;AAmDN4D,8BAAkB,0BAAUV,KAAV,EAAiB;AAC/B;AACAA,sBAAM9B,MAAN,CAAa+B,SAAb,CAAuB9C,MAAvB,CAA8B,aAA9B;AACA6C,sBAAM9B,MAAN,CAAa+B,SAAb,CAAuB9C,MAAvB,CAA8B,aAA9B;AACA,oBAAI,CAAC4B,eAAD,IAAoBC,iBAAiBgB,MAAMK,aAAvB,CAAxB,EAA+D;AAAA,oCACrCnD,EAAE8C,MAAMK,aAAR,EAAuBhC,MAAvB,EADqC;AAAA,wBACnDrB,IADmD,aACnDA,IADmD;AAAA,wBAC7CF,GAD6C,aAC7CA,GAD6C;;AAE3D0C,sCAAkBQ,MAAMK,aAAxB,EAAuCrD,IAAvC,EAA6CF,GAA7C,EACKc,IADL,CACU;AACF,kCAAUZ,IADR;AAEF,kCAAUF;AAFR,qBADV,EAKK8B,QALL,CAKc1B,EAAE,MAAF,CALd;AAMH;AACJ;AAhEK,SADd,EAmEKyD,SAnEL,CAmEe;AACP;AACAC,mBAAO,EAAE5D,MAAM,IAAR,EAAc6D,OAAO,IAArB,EAA2BC,QAAQ,IAAnC,EAAyChE,KAAK,IAA9C,EAFA;;AAIP;AACAiE,2BAAe;AACXC,uBAAO,QADI;AAEXC,yBAAS;AAFE,aALR;;AAUP;AACAC,0BAAc;AACVC,qBAAK,EAAEC,OAAO,GAAT,EAAcC,QAAQ,EAAtB;AADK,aAXP;;AAePC,qBAAS;AAfF,SAnEf,EAoFKC,EApFL,CAoFQ,YApFR,EAoFsB,UAAUvB,KAAV,EAAiB;AAC/B,gBAAI9B,SAAS8B,MAAM9B,MAAnB;AAAA,gBACIR,IAAKC,WAAWO,OAAOsD,YAAP,CAAoB,QAApB,CAAX,KAA6C,CADtD;AAAA,gBAEI3D,IAAKF,WAAWO,OAAOsD,YAAP,CAAoB,QAApB,CAAX,KAA6C,CAFtD;;AAIA;AACAtD,mBAAOuB,KAAP,CAAa2B,KAAb,GAAqBpB,MAAMyB,IAAN,CAAWL,KAAX,GAAmB,IAAxC;AACAlD,mBAAOuB,KAAP,CAAa4B,MAAb,GAAsBrB,MAAMyB,IAAN,CAAWJ,MAAX,GAAoB,IAA1C;;AAEA;AACA3D,iBAAKsC,MAAM0B,SAAN,CAAgB1E,IAArB;AACAa,iBAAKmC,MAAM0B,SAAN,CAAgB5E,GAArB;;AAEAoB,mBAAOuB,KAAP,CAAaC,eAAb,GAA+BxB,OAAOuB,KAAP,CAAa1B,SAAb,GAC3B,eAAeL,CAAf,GAAmB,KAAnB,GAA2BG,CAA3B,GAA+B,KADnC;;AAGAK,mBAAOyD,YAAP,CAAoB,QAApB,EAA8BjE,CAA9B;AACAQ,mBAAOyD,YAAP,CAAoB,QAApB,EAA8B9D,CAA9B;AACH,SAtGL;;AAwGA8B,iBAAS,QAAT,EACKiC,SADL,CACe;AACP;AACAN,qBAAS,IAFF;AAGP;AACAO,sBAAU;AACNC,6BAAajD,SAASkD,IADhB;AAENd,yBAAS,IAFH;AAGNe,6BAAa,EAAElF,KAAK,CAAP,EAAUE,MAAM,CAAhB,EAAmB8D,QAAQ,CAA3B,EAA8BD,OAAO,CAArC;AAHP,aAJH;AASP;AACAoB,wBAAY,IAVL;;AAYP;AACAC,oBAAQ,uBAAS;AACbjF;AACA,oBAAIiB,SAAS8B,MAAM9B,MAAnB;;AACI;AACAR,oBAAI,CAACC,WAAWO,OAAOsD,YAAP,CAAoB,QAApB,CAAX,KAA6C,CAA9C,IAAmDxB,MAAMxC,EAFjE;AAAA,oBAGIK,IAAI,CAACF,WAAWO,OAAOsD,YAAP,CAAoB,QAApB,CAAX,KAA6C,CAA9C,IAAmDxB,MAAMvC,EAHjE;;AAKA;AACAS,uBAAOuB,KAAP,CAAaC,eAAb,GACIxB,OAAOuB,KAAP,CAAa1B,SAAb,GACA,eAAeL,CAAf,GAAmB,MAAnB,GAA4BG,CAA5B,GAAgC,KAFpC;;AAIA;AACAK,uBAAOyD,YAAP,CAAoB,QAApB,EAA8BjE,CAA9B;AACAQ,uBAAOyD,YAAP,CAAoB,QAApB,EAA8B9D,CAA9B;;AAEAG,kCAAkBE,MAAlB;AACH,aA9BM;AA+BP;AACAiE,mBAAOlF;AAhCA,SADf;AAmCH,KA/JD;AAgKH,CA3OD","file":"iframe-drag-n-drop.js","sourcesContent":["(function () {\r\n    const isAlign = (targetOffset, currentOffset) => ({\r\n        isHorizontalAlign: Math.abs(targetOffset.top - currentOffset.top) <= 1,\r\n        isVerticalAlign: Math.abs(targetOffset.left - currentOffset.left) <= 1\r\n    });\r\n\r\n    const removeAlignmentLines = () => $('.horizontal-line, .vertical-line').remove();\r\n\r\n    self.arrowKeyMove = (key, element) => {\r\n        removeAlignmentLines();\r\n\r\n        let dx = 0, dy = 0;\r\n        switch (key) {\r\n            case 37: // left\r\n                dx = -1;\r\n                break;\r\n            case 38: // up\r\n                dy = -1;\r\n                break;\r\n            case 39: // right\r\n                dx = 1;\r\n                break;\r\n            case 40: // down\r\n                dy = 1;\r\n                break;\r\n            default: return; // exit this handler for other keys\r\n        }\r\n\r\n        // keep the dragged position in the data-x/data-y attributes\r\n        const x = (parseFloat(element.attr('data-x')) || 0) + dx,\r\n            y = (parseFloat(element.attr('data-y')) || 0) + dy;\r\n\r\n        element.css({\r\n            transform: `translate(${x}px, ${y}px)`\r\n        });\r\n\r\n        // update the position attributes\r\n        element.attr('data-x', x);\r\n        element.attr('data-y', y);\r\n\r\n        dragAlignmentLine(element.get(0));\r\n    };\r\n\r\n    const dragAlignmentLine = (target) => {\r\n        let horizontalLineExists = false;\r\n        let verticalLineExists = false;\r\n        const targetOffset = $(target).offset();\r\n\r\n        Array.from($('body *:visible:not(script)'))\r\n            .filter(currentValue => currentValue != target)\r\n            .some(currentValue => {\r\n                const currentOffset = $(currentValue).offset();\r\n                const { isHorizontalAlign, isVerticalAlign } = isAlign(targetOffset, currentOffset);\r\n                if (!horizontalLineExists && isHorizontalAlign) {\r\n                    $('<hr />')\r\n                        .addClass('horizontal-line')\r\n                        .css({\r\n                            top: targetOffset.top\r\n                        })\r\n                        .appendTo($('body'));\r\n                    horizontalLineExists = true;\r\n                }\r\n                if (!verticalLineExists && isVerticalAlign) {\r\n                    $('<hr />')\r\n                        .addClass('vertical-line')\r\n                        .css({\r\n                            left: targetOffset.left\r\n                        })\r\n                        .appendTo($('body'));\r\n                    verticalLineExists = true;\r\n                }\r\n                return horizontalLineExists && verticalLineExists;\r\n            });\r\n    };\r\n\r\n    $(document).ready(() => {\r\n        let enteredDropzone = false;\r\n        const isDropzoneParent = element => !!$(element).parents('.dropzone').length;\r\n        const getAbsolutePositionParent = $element => {\r\n            if (!$element.length || $element.css('position') == 'absolute') {\r\n                console.log($element.css('position'));\r\n                return $element;\r\n            } else {\r\n                return getAbsolutePositionParent($element.parent());\r\n            }\r\n        };\r\n\r\n        const setTransformStyle = (element, left, top) => {\r\n            element.style.webkitTransform =\r\n                element.style.transform =\r\n                `translate(${left}px, ${top}px)`;\r\n            return $(element);\r\n        };\r\n\r\n        // enable draggables to be dropped into this\r\n        interact('.dropzone')\r\n            .dropzone({\r\n                // only accept elements matching this CSS selector\r\n                accept: 'body *',\r\n                // Require a 75% element overlap for a drop to be possible\r\n                overlap: 0.50,\r\n                // listen for drop related events:\r\n                ondropactivate: function (event) {\r\n                    // add active dropzone feedback\r\n                    event.target.classList.add('drop-active');\r\n                },\r\n                ondragenter: function (event) {\r\n                    var draggableElement = event.relatedTarget,\r\n                        dropzoneElement = event.target;\r\n\r\n                    // feedback the possibility of a drop\r\n                    dropzoneElement.classList.add('drop-target');\r\n                    draggableElement.classList.add('can-drop');\r\n                },\r\n                ondragleave: function (event) {\r\n                    // remove the drop feedback style\r\n                    event.target.classList.remove('drop-target');\r\n                    event.relatedTarget.classList.remove('can-drop');\r\n                    enteredDropzone = false;\r\n                },\r\n                ondrop: event => {\r\n                    enteredDropzone = true;\r\n\r\n                    let left, top;\r\n                    // dropzone元素不一定是position为absolute的元素\r\n                    // 为了实现左键抬起时不偏移，需要找到dropzone或其父元素中positon为absolute的元素\r\n                    // 并更新拖拽元素的transform属性\r\n                    const $parent = getAbsolutePositionParent($(event.target));\r\n                    if (parent.length) {\r\n                        left = $(event.relatedTarget).offset().left - $parent.offset().left;\r\n                        top = $(event.relatedTarget).offset().top - $parent.offset().top;\r\n                    } else {\r\n                        left = $(event.relatedTarget).offset().left;\r\n                        top = $(event.relatedTarget).offset().top;\r\n                    }\r\n\r\n                    $(event.relatedTarget).appendTo($(event.target));\r\n                    setTransformStyle(event.relatedTarget, left, top)\r\n                        .css({\r\n                            left: 0,\r\n                            top: 0\r\n                        })\r\n                        .attr({\r\n                            'data-x': left,\r\n                            'data-y': top\r\n                        })\r\n                },\r\n                ondropdeactivate: function (event) {\r\n                    // remove active dropzone feedback\r\n                    event.target.classList.remove('drop-active');\r\n                    event.target.classList.remove('drop-target');\r\n                    if (!enteredDropzone && isDropzoneParent(event.relatedTarget)) {\r\n                        const { left, top } = $(event.relatedTarget).offset();\r\n                        setTransformStyle(event.relatedTarget, left, top)\r\n                            .attr({\r\n                                'data-x': left,\r\n                                'data-y': top\r\n                            })\r\n                            .appendTo($('body'));\r\n                    }\r\n                }\r\n            })\r\n            .resizable({\r\n                // resize from all edges and corners\r\n                edges: { left: true, right: true, bottom: true, top: true },\r\n\r\n                // keep the edges inside the parent\r\n                restrictEdges: {\r\n                    outer: 'parent',\r\n                    endOnly: true,\r\n                },\r\n\r\n                // minimum size\r\n                restrictSize: {\r\n                    min: { width: 100, height: 50 },\r\n                },\r\n\r\n                inertia: true,\r\n            })\r\n            .on('resizemove', function (event) {\r\n                var target = event.target,\r\n                    x = (parseFloat(target.getAttribute('data-x')) || 0),\r\n                    y = (parseFloat(target.getAttribute('data-y')) || 0);\r\n\r\n                // update the element's style\r\n                target.style.width = event.rect.width + 'px';\r\n                target.style.height = event.rect.height + 'px';\r\n\r\n                // translate when resizing from top or left edges\r\n                x += event.deltaRect.left;\r\n                y += event.deltaRect.top;\r\n\r\n                target.style.webkitTransform = target.style.transform =\r\n                    'translate(' + x + 'px,' + y + 'px)';\r\n\r\n                target.setAttribute('data-x', x);\r\n                target.setAttribute('data-y', y);\r\n            });\r\n\r\n        interact('body *')\r\n            .draggable({\r\n                // enable inertial throwing\r\n                inertia: true,\r\n                // keep the element within the area of it's parent\r\n                restrict: {\r\n                    restriction: document.body,\r\n                    endOnly: true,\r\n                    elementRect: { top: 0, left: 0, bottom: 1, right: 1 }\r\n                },\r\n                // enable autoScroll\r\n                autoScroll: true,\r\n\r\n                // call this function on every dragmove event\r\n                onmove: event => {\r\n                    removeAlignmentLines();\r\n                    var target = event.target,\r\n                        // keep the dragged position in the data-x/data-y attributes\r\n                        x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,\r\n                        y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;\r\n\r\n                    // translate the element\r\n                    target.style.webkitTransform =\r\n                        target.style.transform =\r\n                        'translate(' + x + 'px, ' + y + 'px)';\r\n\r\n                    // update the posiion attributes\r\n                    target.setAttribute('data-x', x);\r\n                    target.setAttribute('data-y', y);\r\n\r\n                    dragAlignmentLine(target);\r\n                },\r\n                // call this function on every dragend event\r\n                onend: removeAlignmentLines\r\n            });\r\n    });\r\n})();"]}